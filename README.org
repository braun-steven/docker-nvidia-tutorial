#+TITLE: Docker Nvidia Tutorial

* Creating a Custom Docker Image

- A docker image represents your whole experiment environment, that is
  + Linux environment and dependencies
  + Python environment and dependencies

- The /Dockerfile/ gives instructions on how to create the environment
    #+begin_src dockerfile
# Select the base image
FROM nvcr.io/nvidia/pytorch:23.12-py3

# Select the working directory
WORKDIR /app

# Setup image: install system dependencies etc.
# RUN ...

# Install Python requirements
COPY ./requirements.txt ./requirements.txt
RUN pip install -r requirements.txt
    #+end_src

- To build a docker image (we now name it ~docker-tutorial~), run:
    #+begin_src shell
docker build -t docker-tutorial .
    #+end_src

- To test the docker image, run:
    #+begin_src shell
docker run --gpus all -it --rm docker-tutorial python
    #+end_src



* Running a Project in the Container

- Project source code is not supposed to be built into the docker image
- Rather, attach all source code (and other resources) as /volume/ when starting a new container:
 
    Use the ~--volume SOURCE:DESTINATION~ to mount a file/directory from the host machine into the docker container:
    #+begin_src shell
docker run --gpus all --rm -it \
    --volume "$(pwd)"/src:/app/src \
    docker-tutorial \
    python /app/src/run.py
    #+end_src
